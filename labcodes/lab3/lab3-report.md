# Lab3 实验报告
##2013011326   周建宇

##练习1:给未被映射的地址映射上物理页

###实现过程：

先使用`get_pte`获得相应的页表项，即根据页目录和地址找到PTE，表示对应的物理地址不存在，则分配一个页并建立好物理地址和逻辑地址间的映射。

####请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中组成部分对ucore实现页替换算法的潜在用处。

   我们可以通过查看`mmu.h`中的一组宏定义可以看出来，PTE的第5位`PTE_A`表示此页表项对应的页当前是否被访问过，该位可用于时钟算法；PTE的第6位`PTE_D`表示此页表项对应的页当前是否被修改过。这两位用于虚拟内存管理和页面的置换算法的。

####如果ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

   CPU在当前内核栈保存当前被打断的程序现场，也就是依次将EFLAGS，CS，EIP，errorCode压入栈中；如果涉及到用户态到内核态的切换，在压入刚才的几个值之前，还会更换一个新的栈，并且压入ss的值和ESP的值。
   
   由于页访问异常的中断号是0xE，CPU把异常中断号0xE对应的中断服务例程的地址加载到CS和EIP寄存器中，开始执行中断服务例程。

##练习2：补充完成基于FIFO的页面替换算法

####实现过称：

在`_fifo_map_swappable`中把新来的页插入链表头,`_fifo_swap_out_victim`中把链表尾的页从连表中删除。

并且其中仿照答案加入了一些断言，判定一些违法的情况。

####如果要在ucore上实现"extended clock页替换算法"请给你的设计方案，现有的swap_manager框架是否足以支持在ucore中实现此算法？如果是，请给你的设计方案。如果不是，请给出你的新的扩展和基此扩展的设计方案。

现有的`swap_manager`框架足以支持在ucore中实现此算法，与fifo相比不同的是需要在`swap out`的时候对当前指针指向的页所对应的PTE进行查询，得到（引用位,修改位）。同时拓展时钟算法需要一个“时针”，因此需要在struct mm中添加一项只想swap链表中某项的指针。

* 需要被换出的页的特征是什么？

	PTE_A和PTE_D都被置为了零.

* 在ucore中如何判断具有这样特征的页？

	读取当前页的PTE，得到（引用位，修改位），做出判断。

 * 何时进行换入和换出操作？

	当试图得到空闲页时，发现当前没有空闲的物理页可供分配，这时才开始查找“不常用”页面，并把一个或多个这样的页换出到硬盘上。